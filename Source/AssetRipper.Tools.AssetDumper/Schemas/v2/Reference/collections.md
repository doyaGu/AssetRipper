# collections.schema.json Reference

**Schema ID:** `https://schemas.assetripper.dev/assetdump/v2/facts/collections.schema.json`
**Title:** AssetDump v2 Collections Facts
**Domain:** `collections`
**Layer:** Facts
**Version:** 2.0

---

## Overview

The `collections.schema.json` defines per-collection metadata describing Unity SerializedFiles and embedded built-in resources. Collections represent individual asset files (`.assets`, `.unity`, `.resource`, etc.) that contain groups of related Unity objects.

### Purpose

- Document Unity SerializedFile metadata (format version, platform, Unity version)
- Track collection dependencies (FileIdentifier references)
- Link collections to parent bundles and optional scenes
- Classify collection types (Serialized, Processed, Virtual)
- Provide dual dependency mapping for efficient lookups

### Key Characteristics

- **Primary Key:** `collectionId` (CollectionID)
- **Domain Identifier:** `"collections"` (constant)
- **Cardinality:** One record per AssetCollection (typically 10-100 per project)
- **Unity Mapping:** One collection ≈ one SerializedFile or ProcessedCollection

---

## Required Fields

| Field | Type | Description |
|-------|------|-------------|
| domain | string (const) | Domain identifier: "collections" |
| collectionId | CollectionID | Stable collection identifier |
| name | string | Primary filename |
| platform | string | Unity build target/platform |
| unityVersion | string | Unity player/editor version |
| endian | enum | LittleEndian / BigEndian |
| bundle | BundleRef | Parent bundle reference |
| dependencies | array | Ordered dependency CollectionIDs |
| assetCount | integer | Total assets in collection |

---

## Field Reference

### domain

**Type:** `string`
**Const:** `"collections"`
**Required:** ✓

**Example:**
```json
"domain": "collections"
```

---

### collectionId

**Type:** `CollectionID`
**Required:** ✓
**Reference:** `core.schema.json#/$defs/CollectionID`

**Description:**
Stable identifier for the collection. Typically the filename or a deterministic hash.

**Examples:**
```json
"collectionId": "sharedassets0.assets"
"collectionId": "level0"
"collectionId": "BUILTIN-EXTRA"
```

**Special Collections:**
- `BUILTIN-EXTRA`: Unity built-in extra resources
- `BUILTIN-DEFAULT`: Unity default resources
- `BUILTIN-EDITOR`: Unity editor resources

---

### name

**Type:** `string`
**Required:** ✓

**Description:**
Primary filename (e.g., sharedassets1.assets).

**Examples:**
```json
"name": "sharedassets0.assets"
"name": "level0"
"name": "resources.assets"
```

---

### collectionType

**Type:** `string`
**Enum:** `["Serialized", "Processed", "Virtual"]`
**Required:** ✗

**Description:**
Type of collection indicating its origin.

**Values:**

| Type | Description |
|------|-------------|
| Serialized | From Unity SerializedFile (.assets, .unity) |
| Processed | Generated by AssetRipper processing |
| Virtual | Base class instance (rarely used) |

**Example:**
```json
"collectionType": "Serialized"
```

---

### friendlyName

**Type:** `string`
**Required:** ✗

**Description:**
Human-friendly scene identifier derived from project-relative path. Drops "Assets/" prefix, strips ".unity", replaces underscores/hyphens with spaces.

**Examples:**
```json
"friendlyName": "Main Menu"     // from "Assets/Scenes/Main_Menu.unity"
"friendlyName": "Level 1"       // from "Assets/Scenes/Level-1.unity"
```

---

### bundleName

**Type:** `string`
**Required:** ✗

**Description:**
Bundle name when sourced from an AssetBundle. Present when the collection originates from a Unity AssetBundle file.

**Example:**
```json
"bundleName": "characters"
```

---

### filePath

**Type:** `string`
**Required:** ✗

**Description:**
Relative file path for the serialized collection on disk.

**Examples:**
```json
"filePath": "level0"
"filePath": "sharedassets0.assets"
"filePath": "Resources/unity_builtin_extra"
```

---

### platform

**Type:** `string`
**Required:** ✓

**Description:**
Unity build target/platform string.

**Common Values:**
```json
"platform": "StandaloneWindows64"
"platform": "StandaloneOSX"
"platform": "Android"
"platform": "iOS"
"platform": "WebGL"
```

---

### unityVersion

**Type:** `string`
**Required:** ✓

**Description:**
Unity player/editor version that produced the SerializedFile. This is the current version after any AssetRipper processing.

**Format:** `MAJOR.MINOR.PATCH[f|p]BUILD`

**Examples:**
```json
"unityVersion": "2021.3.5f1"
"unityVersion": "2020.3.48f1"
"unityVersion": "2019.4.40f1"
```

---

### originalUnityVersion

**Type:** `string`
**Required:** ✗

**Description:**
Original Unity version before any processing modifications. May differ from unityVersion if the collection was modified by AssetRipper.

**Example:**
```json
"originalUnityVersion": "2020.3.1f1"
"unityVersion": "2021.3.5f1"  // Upgraded during processing
```

---

### formatVersion

**Type:** `integer`
**Minimum:** 0
**Required:** ✗

**Description:**
SerializedFile header format version controlling table layout and offset width. Only present for SerializedAssetCollection.

**Common Values:**
- 6-9: Unity 3.x-4.x
- 14-15: Unity 5.0-5.4
- 17: Unity 5.5+
- 22: Unity 2019.3+

**Example:**
```json
"formatVersion": 22
```

---

### endian

**Type:** `string`
**Enum:** `["LittleEndian", "BigEndian"]`
**Required:** ✓

**Description:**
Byte order for binary serialization.

**Examples:**
```json
"endian": "LittleEndian"   // PC, Android, iOS (modern)
"endian": "BigEndian"      // PlayStation, Xbox (some), iOS (old)
```

---

### flagsRaw

**Type:** `string`
**Required:** ✗

**Description:**
Bitflag string describing Unity SerializedFile flags as recorded on disk.

**Example:**
```json
"flagsRaw": "0x00000004"
```

---

### flags

**Type:** `array` of strings
**Required:** ✗

**Description:**
Optional flag set derived from Unity SerializedFile header.

**Example:**
```json
"flags": ["HasTypeTree", "BigIDEnabled"]
```

---

### isSceneCollection

**Type:** `boolean`
**Required:** ✗

**Description:**
True when the collection originates from a Unity scene file (.unity).

**Examples:**
```json
"isSceneCollection": true   // From .unity file
"isSceneCollection": false  // From .assets file
```

---

### bundle

**Type:** `BundleRef`
**Required:** ✓
**Reference:** `core.schema.json#BundleRef`

**Description:**
Reference to the parent Bundle containing this collection. Every collection must belong to a Bundle.

**Example:**
```json
"bundle": {
  "bundlePk": "A1B2C3D4",
  "bundleName": "level0"
}
```

---

### scene

**Type:** `SceneRef`
**Required:** ✗
**Reference:** `core.schema.json#SceneRef`

**Description:**
Reference to the Scene if this collection is part of one. Present when isSceneCollection is true.

**Example:**
```json
"scene": {
  "sceneGuid": "1a2b3c4d5e6f7a8b9c0d1e2f3a4b5c6d",
  "sceneName": "MainMenu",
  "scenePath": "Assets/Scenes/MainMenu.unity"
}
```

---

### collectionIndex

**Type:** `integer`
**Minimum:** 0
**Required:** ✗

**Description:**
Index of this collection within its parent bundle's collection list. Used for maintaining collection order.

**Example:**
```json
"collectionIndex": 2  // Third collection in bundle (0-based)
```

---

### dependencies

**Type:** `array` of CollectionID
**Required:** ✓

**Description:**
Ordered list of dependency CollectionIDs. **Index 0 is always self-reference** for correct correspondence with Unity file indices. Subsequent entries may be null if they could not be resolved.

**Example:**
```json
"dependencies": [
  "sharedassets0.assets",    // [0] = self
  "sharedassets1.assets",    // [1]
  "BUILTIN-EXTRA",           // [2]
  "level1"                   // [3]
]
```

**Unity Correspondence:**
```csharp
// SerializedFile.Dependencies
// PPtr.m_FileID maps to this array
// FileID 0 = self (dependencies[0])
// FileID 1 = dependencies[1]
// etc.
```

**Important:**
- Always starts with self-reference at index 0
- May contain null for unresolved dependencies
- Order matters (corresponds to Unity's dependency indices)

---

### dependencyIndices

**Type:** `object` (string → integer map)
**Required:** ✗

**Description:**
Map from dependency CollectionID to its index in dependencies array. Provides fast reverse lookup for PPtr reference resolution.

**Example:**
```json
"dependencyIndices": {
  "sharedassets0.assets": 0,
  "sharedassets1.assets": 1,
  "BUILTIN-EXTRA": 2,
  "level1": 3
}
```

**Usage:**
```python
# Resolve PPtr reference
def resolve_pptr(pptr):
    file_id = pptr.m_FileID
    collection_id = dependencies[file_id]
    return collection_id, pptr.m_PathID

# Reverse lookup
def get_file_id(collection_id):
    return dependencyIndices[collection_id]
```

---

### assetCount

**Type:** `integer`
**Minimum:** 0
**Required:** ✓

**Description:**
Total number of assets (Unity objects) in this collection.

**Examples:**
```json
"assetCount": 523
"assetCount": 0     // Empty collection
"assetCount": 15234 // Large scene
```

---

### source

**Type:** `object`
**Required:** ✗

**Description:**
Physical source location information for this collection, useful for debugging and data provenance tracking.

**Properties:**

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| uri | string | ✗ | URI describing physical source |
| offset | integer | ✗ | Byte offset within source file |
| size | integer | ✗ | Size in bytes within source file |

**Example:**
```json
"source": {
  "uri": "file:///path/to/game/Data/level0",
  "offset": 0,
  "size": 524288
}
```

---

### unity

**Type:** `object`
**Required:** ✗

**Description:**
Unity-specific metadata for special collection types.

**Properties:**

| Field | Type | Description |
|-------|------|-------------|
| builtInClassification | enum | BUILTIN-EXTRA / BUILTIN-DEFAULT / BUILTIN-EDITOR |

**Example:**
```json
"unity": {
  "builtInClassification": "BUILTIN-EXTRA"
}
```

**Built-in Classifications:**
- **BUILTIN-EXTRA**: Unity's built-in extra resources (shaders, fonts, icons)
- **BUILTIN-DEFAULT**: Unity's default resources
- **BUILTIN-EDITOR**: Unity editor-only resources

---

## Complete Examples

### Standard Asset Collection

```json
{
  "domain": "collections",
  "collectionId": "sharedassets0.assets",
  "name": "sharedassets0.assets",
  "collectionType": "Serialized",
  "filePath": "sharedassets0.assets",
  "platform": "StandaloneWindows64",
  "unityVersion": "2021.3.5f1",
  "formatVersion": 22,
  "endian": "LittleEndian",
  "isSceneCollection": false,
  "bundle": {
    "bundlePk": "A1B2C3D4",
    "bundleName": "level0"
  },
  "collectionIndex": 0,
  "dependencies": [
    "sharedassets0.assets",
    "sharedassets1.assets",
    "BUILTIN-EXTRA"
  ],
  "dependencyIndices": {
    "sharedassets0.assets": 0,
    "sharedassets1.assets": 1,
    "BUILTIN-EXTRA": 2
  },
  "assetCount": 523
}
```

### Scene Collection

```json
{
  "domain": "collections",
  "collectionId": "level0",
  "name": "level0",
  "collectionType": "Serialized",
  "friendlyName": "Level 0",
  "filePath": "level0",
  "platform": "StandaloneWindows64",
  "unityVersion": "2021.3.5f1",
  "originalUnityVersion": "2020.3.1f1",
  "formatVersion": 22,
  "endian": "LittleEndian",
  "flags": ["HasTypeTree"],
  "isSceneCollection": true,
  "bundle": {
    "bundlePk": "A1B2C3D4",
    "bundleName": "level0"
  },
  "scene": {
    "sceneGuid": "1a2b3c4d5e6f7a8b9c0d1e2f3a4b5c6d",
    "sceneName": "Level0",
    "scenePath": "Assets/Scenes/Level0.unity"
  },
  "collectionIndex": 1,
  "dependencies": [
    "level0",
    "sharedassets0.assets",
    "sharedassets1.assets",
    "BUILTIN-EXTRA"
  ],
  "dependencyIndices": {
    "level0": 0,
    "sharedassets0.assets": 1,
    "sharedassets1.assets": 2,
    "BUILTIN-EXTRA": 3
  },
  "assetCount": 15234,
  "source": {
    "uri": "file:///D:/Games/MyGame/Data/level0",
    "offset": 0,
    "size": 8388608
  }
}
```

### Built-in Collection

```json
{
  "domain": "collections",
  "collectionId": "BUILTIN-EXTRA",
  "name": "unity_builtin_extra",
  "collectionType": "Serialized",
  "platform": "StandaloneWindows64",
  "unityVersion": "2021.3.5f1",
  "endian": "LittleEndian",
  "isSceneCollection": false,
  "bundle": {
    "bundlePk": "00000000",
    "bundleName": "GameBundle"
  },
  "dependencies": [
    "BUILTIN-EXTRA"
  ],
  "dependencyIndices": {
    "BUILTIN-EXTRA": 0
  },
  "assetCount": 142,
  "unity": {
    "builtInClassification": "BUILTIN-EXTRA"
  }
}
```

---

## Usage Patterns

### Resolving PPtr References

```python
def resolve_pptr(collection, pptr):
    """Resolve a PPtr to its target collection and pathId"""
    file_id = pptr.m_FileID

    # Check bounds
    if file_id < 0 or file_id >= len(collection.dependencies):
        return None, None  # Invalid FileID

    target_collection_id = collection.dependencies[file_id]
    if target_collection_id is None:
        return None, None  # Unresolved dependency

    return target_collection_id, pptr.m_PathID
```

### Finding Collections by Type

```python
def get_scene_collections(all_collections):
    """Get all scene collections"""
    return [c for c in all_collections if c.isSceneCollection]

def get_asset_collections(all_collections):
    """Get all non-scene collections"""
    return [c for c in all_collections if not c.isSceneCollection]
```

### Building Dependency Graph

```python
def build_dependency_graph(collections):
    """Build collection dependency graph"""
    graph = {}
    for collection in collections:
        # Skip self-reference at index 0
        deps = collection.dependencies[1:]
        graph[collection.collectionId] = [d for d in deps if d is not None]
    return graph
```

---

## Related Schemas

### Parent Container

- **bundles.schema.json**: Parent bundle (via bundle field)

### Child Entities

- **assets.schema.json**: Assets belong to collections (via pk.collectionId)

### Relationships

- **collection_dependencies.schema.json**: Explicit dependency edges

### Scene Association

- **scenes.schema.json**: Scene metadata (linked via scene field)

---

## Implementation Notes

### C# Model

```csharp
public class CollectionRecord
{
    public required string Domain { get; init; } = "collections";
    public required string CollectionId { get; init; }
    public required string Name { get; init; }
    public string? CollectionType { get; init; }
    public string? FriendlyName { get; init; }
    public string? BundleName { get; init; }
    public string? FilePath { get; init; }
    public required string Platform { get; init; }
    public required string UnityVersion { get; init; }
    public string? OriginalUnityVersion { get; init; }
    public int? FormatVersion { get; init; }
    public required string Endian { get; init; }
    public string? FlagsRaw { get; init; }
    public string[]? Flags { get; init; }
    public bool? IsSceneCollection { get; init; }
    public required BundleRef Bundle { get; init; }
    public SceneRef? Scene { get; init; }
    public int? CollectionIndex { get; init; }
    public required string[] Dependencies { get; init; }
    public Dictionary<string, int>? DependencyIndices { get; init; }
    public required int AssetCount { get; init; }
    public SourceInfo? Source { get; init; }
    public UnityInfo? Unity { get; init; }
}
```

### Dependency Index Building

```csharp
public static Dictionary<string, int> BuildDependencyIndices(string[] dependencies)
{
    var indices = new Dictionary<string, int>();
    for (int i = 0; i < dependencies.Length; i++)
    {
        if (dependencies[i] != null)
        {
            indices[dependencies[i]] = i;
        }
    }
    return indices;
}
```

---

**End of collections.schema.json Reference**
